# Алгоритм прогнозирования погоды

## Обзор

Алгоритм прогнозирования погоды в данной системе реализован в классе `WeatherPredictor`. Он использует простой подход на основе анализа трендов для предсказания будущих значений температуры и влажности.

## Принцип работы

### 1. Анализ трендов

Алгоритм анализирует изменения текущих показаний по сравнению с предыдущими измерениями:

```cpp
void WeatherPredictor::updateTrends(const WeatherData& current, const WeatherData& previous) {
    if (current.timestamp > previous.timestamp) {
        tempTrend = (current.temperature - previous.temperature) / 
                   ((current.timestamp - previous.timestamp) / 1000.0f);
        humidityTrend = (current.humidity - previous.humidity) / 
                       ((current.timestamp - previous.timestamp) / 1000.0f);
    }
}
```

Тренды рассчитываются как скорость изменения параметров в единицу времени (градусы/проценты в секунду).

### 2. Прогнозирование

На основе рассчитанных трендов выполняется экстраполяция для получения прогнозируемых значений:

```cpp
void WeatherPredictor::predictWeather(WeatherData& data, const WeatherData& current) {
    // Простая экстраполяция на основе трендов
    data.predictedTemp = current.temperature + (tempTrend * 3600); // Прогноз на 1 час вперед
    data.predictedHumidity = current.humidity + (humidityTrend * 3600);

    // Ограничиваем значения в разумных пределах
    data.predictedTemp = constrain(data.predictedTemp, -50.0f, 60.0f);
    data.predictedHumidity = constrain(data.predictedHumidity, 0.0f, 100.0f);
}
```

Прогноз делается на 1 час вперед (3600 секунд), но может быть легко изменен.

## Ограничения алгоритма

### 1. Простота модели

Алгоритм использует линейную модель прогнозирования, которая имеет следующие ограничения:
- Не учитывает сезонные изменения
- Не учитывает атмосферное давление при прогнозировании
- Не учитывает внешние факторы (например, давление, ветер, облачность)

### 2. Краткосрочный прогноз

Прогноз точен только для краткосрочной перспективы (несколько часов), так как основан на краткосрочных трендах.

### 3. Чувствительность к шуму

Из-за возможных колебаний показаний датчиков алгоритм может быть чувствителен к шуму, особенно при коротких интервалах измерений.

## Возможные улучшения

### 1. Усреднение трендов

Вместо использования только последних двух измерений можно использовать усредненные тренды за определенный период:

```cpp
// Пример улучшенного подхода
float getSmoothedTrend(std::vector<float> values, std::vector<unsigned long> timestamps) {
    // Реализация усреднения тренда по нескольким точкам
    // Можно использовать метод наименьших квадратов или скользящее среднее
}
```

### 2. Учет давления

Атмосферное давление является важным индикатором погодных изменений, поэтому его можно использовать для коррекции прогноза:

```cpp
// Пример интеграции давления в прогноз
void predictWithPressure(WeatherData& data, float pressureChangeRate) {
    // Учет влияния изменения давления на прогноз
    // Например, снижение давления может указывать на приближение осадков
}
```

### 3. Сезонная коррекция

Для долгосрочного прогноза можно ввести сезонные корректировки:

```cpp
// Пример учета сезонных изменений
float seasonalAdjustment(int month, float basePrediction) {
    // Корректировка прогноза в зависимости от сезона
    // Учет климатических особенностей региона
}
```

## Применение в системе

Алгоритм интегрирован в основной цикл программы:

```cpp
if (sensorManager.readAllSensors(currentData)) {
    // Обновляем тренды и делаем прогноз
    weatherPredictor.updateTrends(currentData, previousData);
    weatherPredictor.predictWeather(currentData, currentData);
    
    // Сохраняем данные
    dataStorage.saveData(currentData);
    
    // Обновляем предыдущие данные
    previousData = currentData;
}
```

## Преимущества реализации

1. **Простота**: Алгоритм легко понимается и модифицируется
2. **Эффективность**: Минимальные вычислительные затраты, подходящие для ESP32
3. **Адаптивность**: Реагирует на краткосрочные изменения погоды
4. **Интеграция**: Легко интегрируется с остальной системой

## Заключение

Реализованный алгоритм прогнозирования предоставляет базовую функциональность для предсказания погоды на основе трендов. Хотя он не заменяет профессиональные метеорологические модели, он обеспечивает полезные краткосрочные прогнозы для автономной погодной станции.